(function(c,a){"function"===typeof define&&define.amd?define([],a):c.JSQL=a()})(this,function(){var c=function(a){this.tmp=this.data=a;this.query={stats:{count:a.length,operations:[]},options:{},select:[],distinct:void 0,sort:{}}};c.prototype._extend=function(a,b){var e={},d;for(d in a)a.hasOwnProperty(d)&&(e[d]=a[d]);for(d in b)b.hasOwnProperty(d)&&(e[d]=b[d]);return e};c.prototype._queryObj=function(a,b){return this._filter(a,function(a){for(var d in b)if(b.hasOwnProperty(d)&&a[d]!=b[d])return!1;
return!0})};c.prototype._isObjectEmpty=function(a){return a==={}?!0:!1};c.prototype._getUnique=function(a){var b=[];return this._filter(a,function(a){if(-1!==b.indexOf(a))return!1;b.push(a);return!0})};c.prototype._filter=function(a,b){var e=[],d,c=a.length;for(d=0;d<c;d++)b(a[d])&&e.push(a[d]);return e};c.prototype._map=function(a,b){var e=[],d,c=a.length;for(d=0;d<c;d++)e.push(b(a[d]));return e};c.prototype._pluck=function(a,b){for(var e=0,d=a.length,c=[],e=0;e<d;e++)c.push(a[e][b]);return c};c.prototype._pluckMany=
function(a,b){return this._map(a,function(a){var d={},c,g=b.length;for(c=0;c<g;c++)d[b[c]]=a[b[c]];return d})};c.prototype._addOp=function(a){this.query.stats.operations.push(a)};c.prototype.getStats=function(){return this.query.stats};c.prototype.options=function(a){this.options=this._extend(this.options,a)};c.prototype.select=function(){this._reset();this._addOp("select");this.query.select=arguments;return this};c.prototype.where=function(a){if(1<arguments.length&&this._areAllObjects(arguments))return this.orWhere(arguments),
this;if(2===arguments.length&&"string"===typeof arguments[0]){this._addOp("where");var b={};b[arguments[0]]=arguments[1];this.tmp=this._queryObj(this.tmp,b);return this}if(Array.isArray(a))return this.orWhere(a),this;if("object"===typeof a)return this._addOp("where"),this.tmp=this._queryObj(this.tmp,a),this;if(0===arguments.length)return this;throw"Invalid arguments for where clause";};c.prototype._areAllObjects=function(a){var b,c=a.length;if(0===c)return!1;for(b=0;b<c;b++)if("object"!==typeof a[b]||
null===a[b])return!1;return!0};c.prototype.orWhere=function(a){this._addOp("where");var b=this;this.tmp=this._filter(this.tmp,function(c){var d,f=a.length;for(d=0;d<f;d++)if(b._queryObj([c],a[d]).length)return!0});return this};c.prototype.associate=function(a,b,c,d){var f=[],g,k=this.tmp.length,h;for(g=0;g<k;g++)h=this._queryObj(b,{id:this.tmp[g][a]}),this.tmp[g][d]=1===h.length?h[0][c]:void 0,f.push(this.tmp[g]);this.tmp=f;return this};c.prototype.sortBy=function(a,b){if("object"===typeof a){for(var c in a)a.hasOwnProperty(c)&&
("desc"===a[c]?this.sortDesc(c):this.sortAsc(c));return this}"desc"===b?this.sortDesc(a):this.sortAsc(a);return this};c.prototype.sortAsc=function(a){this.query.sort[a]=1;return this};c.prototype.sortDesc=function(a){this.query.sort[a]=-1;return this};c.prototype._getSorted=function(a,b){var c=Object.keys(b),d=this._sortFirstBy(c[0],b[c[0]]);if(1===c.length)return a.sort(d);delete b[c[0]];for(var f in b)b.hasOwnProperty(f)&&(this._addOp("sort"),d=d.thenBy(f,b[f]));return a.sort(d)};c.prototype._sortFirstBy=
function(){function a(a,b){if("function"!==typeof a){var c=a;a=function(a,b){return a[c]<b[c]?-1:a[c]>b[c]?1:0}}if(1===a.length){var e=a;a=function(a,b){return e(a)<e(b)?-1:e(a)>e(b)?1:0}}return-1===b?function(b,c){return-a(b,c)}:a}function b(b,f){b=a(b,f);b.thenBy=c;return b}function c(d,e){var g=this;d=a(d,e);return b(function(a,b){return g(a,b)||d(a,b)})}return b}();c.prototype.limit=function(a,b){this._addOp("limit");b=b||0;this.tmp=this.tmp.slice(0+b,a+b);return this};c.prototype["in"]=function(a,
b){this._addOp("in");this.tmp=this._filter(this.tmp,function(c){return-1!==b.indexOf(c[a])});return this};c.prototype.notIn=function(a,b){this._addOp("notIn");this.tmp=this._filter(this.tmp,function(c){return-1===b.indexOf(c[a])});return this};c.prototype.between=function(a,b,c,d){this._addOp("between");if(d)return this.tmp=this._filter(this.tmp,function(d){return b<d[a]&&d[a]<c}),this;this.tmp=this._filter(this.tmp,function(d){return b<=d[a]&&d[a]<=c});return this};c.prototype.regEx=function(a,b,
c){this._addOp("regex");var d;if(c)return d=new RegExp(b,"i"),this.tmp=this._filter(this.tmp,function(b){return d.test(b[a])}),this;d=new RegExp(b);this.tmp=this._filter(this.tmp,function(b){return d.test(b[a])});return this};c.prototype._escapeRegex=function(a){return String(a).replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")};c.prototype.startsWith=function(a,b){this._addOp("startsWith");b=this._escapeRegex(b);this.regEx(a,"^"+b,!0);return this};c.prototype.endsWith=function(a,b){this._addOp("endsWith");
b=this._escapeRegex(b);this.regEx(a,b+"$",!0);return this};c.prototype.like=function(a,b){this._addOp("like");b=this._escapeRegex(b);this.regEx(a,b,!0);return this};c.prototype.lt=function(a,b){this._addOp("lt");this.tmp=this._filter(this.tmp,function(c){return c[a]<b});return this};c.prototype.gt=function(a,b){this._addOp("gt");this.tmp=this._filter(this.tmp,function(c){return c[a]>b});return this};c.prototype.lte=function(a,b){this._addOp("lte");this.tmp=this._filter(this.tmp,function(c){return c[a]<=
b});return this};c.prototype.gte=function(a,b){this._addOp("gte");this.tmp=this._filter(this.tmp,function(c){return c[a]>=b});return this};c.prototype.transform=function(a,b){this._addOp("transform");this.tmp=this._filter(this.tmp,function(c){c[a]=b(c);return c});return this};c.prototype.get=function(){var a=this.tmp;this._isObjectEmpty(this.query.sort)||(a=this._getSorted(a,this.query.sort));this.query.select.length&&(a=this._pluckMany(a,this.query.select));this.query.distinct&&(this._addOp("distinct"),
a=this._getUnique(this._filter(this._pluck(a,this.query.distinct),function(a){return void 0===a?!1:!0})));return a};c.prototype.getOne=function(){return this.get().slice(0,1)[0]};c.prototype.count=function(){return this.tmp.length};c.prototype.distinct=function(a){this.query.distinct=a;return this};c.prototype._reset=function(){this.tmp=this.data;this.query={stats:{count:this.data.length,operations:[]},options:{},select:[],distinct:void 0,sort:{}}};return c});